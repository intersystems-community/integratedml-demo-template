services:

  irisimlsvr:
    build:
      context: ./iris-aa-server
    image: iris-ml-server:latest
    hostname: irisimlsvr
    restart: on-failure
    # CPU limit (IRIS Community Edition supports up to 20 cores)
    cpus: 2
    ports:
      - "8091:1972"   # SuperServer port
      - "8092:52773"  # Web/Management Portal port
    volumes:
      - ./iris-shared:/shared
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:52773/csp/sys/UtilHome.csp"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  jupyter:
    build:
      context: ./tf2-jupyter
    image: tf2-jupyter:latest
    hostname: jupyter
    restart: on-failure
    ports:
      - "8896:8888"  # Jupyter notebook port
      - "6026:6006"  # TensorBoard port
    volumes:
      - ./jupyter-samples:/tf
    depends_on:
      - irisimlsvr
